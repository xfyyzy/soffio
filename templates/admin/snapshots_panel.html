{% extends "admin/layouts/panel.html" %}

{% block panel_id %}snapshots{% endblock %}

{% block panel_heading %}{{ content.heading }}{% endblock %}

{% block panel_toolbar %}
      <a href="{{ content.new_snapshot_href }}">New Snapshot</a>
{% endblock panel_toolbar %}

{% block panel_controls %}
{% let panel_action = content.panel_action %}
{% include "admin/partials/filter_form.html" %}
{% endblock panel_controls %}

{% block panel_content %}
{% let panel_action = content.panel_action %}
    <table data-role="publishable-table">
      <thead>
        <tr>
          <th scope="col">Version</th>
          <th scope="col">Description</th>
          <th scope="col">Created At</th>
          <th scope="col">Created By</th>
          <th scope="col">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for item in content.snapshots %}
        <tr data-role="snapshot-row" data-snapshot-id="{{ item.id }}">
          <td>{{ item.version }}</td>
          <td>
            {% if let Some(desc) = &item.description %}
            {{ desc }}
            {% else %}
            <span data-role="muted">â€”</span>
            {% endif %}
          </td>
          <td>{{ item.created_at }}</td>
          <td>{{ item.created_by }}</td>
          <td data-role="publishable-actions">
            <div data-role="row-actions">
              <a href="{{ item.edit_href }}">Edit</a>
              <form method="post" action="{{ item.rollback_action }}" data-role="inline-form"
                data-on-submit__prevent="(@post(`{{ item.rollback_action }}`, { contentType: 'form' }))">
                {% if let Some(cursor) = &content.cursor_param %}
                <input type="hidden" name="cursor" value="{{ cursor }}">
                {% endif %}
                {% if let Some(trail) = &content.trail %}
                <input type="hidden" name="trail" value="{{ trail }}">
                {% endif %}
                {% if let Some(search) = &content.filter_search %}
                <input type="hidden" name="search" value="{{ search }}">
                {% endif %}
                {% if let Some(month) = &content.filter_month %}
                <input type="hidden" name="month" value="{{ month }}">
                {% endif %}
                <button type="submit">Rollback</button>
              </form>
              <form method="post" action="{{ item.delete_action }}" data-role="inline-form"
                data-on-submit__prevent="(@post(`{{ item.delete_action }}`, { contentType: 'form' }))">
                {% if let Some(cursor) = &content.cursor_param %}
                <input type="hidden" name="cursor" value="{{ cursor }}">
                {% endif %}
                {% if let Some(trail) = &content.trail %}
                <input type="hidden" name="trail" value="{{ trail }}">
                {% endif %}
                {% if let Some(search) = &content.filter_search %}
                <input type="hidden" name="search" value="{{ search }}">
                {% endif %}
                {% if let Some(month) = &content.filter_month %}
                <input type="hidden" name="month" value="{{ month }}">
                {% endif %}
                <button type="submit" data-variant="danger">Delete</button>
              </form>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
{% include "admin/partials/pagination.html" %}
{% endblock panel_content %}
