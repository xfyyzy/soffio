{% extends "admin/shell.html" %}

{% block content %}
<section data-role="panel">
  <header data-role="panel-header">
    <h2 data-role="panel-title">Audit Log</h2>
  </header>
  <div data-role="panel-body">
    <form data-role="filter-form" method="get">
      <label>
        <span>Actor</span>
        <input type="text" name="actor" value="{% if let Some(value) = &view.content.filter_actor %}{{ value }}{% endif %}">
      </label>
      <label>
        <span>Action</span>
        <input type="text" name="action" value="{% if let Some(value) = &view.content.filter_action %}{{ value }}{% endif %}">
      </label>
      <label>
        <span>Entity Type</span>
        <input type="text" name="entity_type" value="{% if let Some(value) = &view.content.filter_entity_type %}{{ value }}{% endif %}">
      </label>
      <label>
        <span>Search</span>
        <input type="text" name="search" value="{% if let Some(value) = &view.content.filter_search %}{{ value }}{% endif %}">
      </label>
      <div data-role="filter-actions">
        <button type="submit">Apply Filters</button>
        {% if view.content.filter_actor.is_some() || view.content.filter_action.is_some() || view.content.filter_entity_type.is_some() || view.content.filter_search.is_some() %}
        <a href="/audit" data-role="secondary">Clear</a>
        {% endif %}
      </div>
    </form>
    <table data-role="audit-table">
      <thead>
        <tr>
          <th scope="col">Actor</th>
          <th scope="col">Action</th>
          <th scope="col">Entity</th>
          <th scope="col">Recorded</th>
        </tr>
      </thead>
      <tbody>
        {% for entry in view.content.entries %}
        <tr data-role="audit-row" data-audit-id="{{ entry.id }}">
          <td>{{ entry.actor }}</td>
          <td>{{ entry.action }}</td>
          <td>{{ entry.entity }}</td>
          <td>{{ entry.created_at }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% if let Some(cursor) = &view.content.next_cursor %}
    <nav data-role="pagination">
      <a data-role="next" href="/audit?cursor={{ cursor }}{% if !view.content.filter_query.is_empty() %}&{{ view.content.filter_query }}{% endif %}">Next</a>
    </nav>
    {% endif %}
  </div>
</section>
{% endblock %}
