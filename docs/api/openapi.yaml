openapi: 3.1.0
info:
  title: Soffio Headless Admin API
  version: "0.1.0"
  description: |
    Authenticated JSON API for managing Soffio content. All endpoints require
    a Bearer token that carries an API key issued from the admin UI. Scopes
    are enforced server-side (see descriptions for required scope).
  license:
    name: BSD-2-Clause
    url: https://opensource.org/licenses/BSD-2-Clause
servers:
  - url: http://127.0.0.1:3000
security:
  - ApiKeyAuth: []
components:
  securitySchemes:
    ApiKeyAuth:
      type: http
      scheme: bearer
      bearerFormat: API key (sk_prefix_secret)
  schemas:
    CursorPagePost:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Post'
        next_cursor:
          type: string
      required: [items]
    CursorPagePage:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Page'
        next_cursor:
          type: string
      required: [items]
    CursorPageTag:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Tag'
        next_cursor:
          type: string
      required: [items]
    CursorPageNavigationItem:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/NavigationItem'
        next_cursor:
          type: string
      required: [items]
    CursorPageUpload:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Upload'
        next_cursor:
          type: string
      required: [items]
    CursorPageJob:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Job'
        next_cursor:
          type: string
      required: [items]
    CursorPageAudit:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/AuditEntry'
        next_cursor:
          type: string
      required: [items]
    CursorPageSnapshot:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Snapshot'
        next_cursor:
          type: string
      required: [items]
    Post:
      type: object
      properties:
        id: { type: string, format: uuid }
        slug: { type: string }
        title: { type: string }
        excerpt: { type: string }
        body_markdown: { type: string }
        summary_markdown: { type: string }
        summary_html: { type: string }
        status: { $ref: '#/components/schemas/PostStatus' }
        pinned: { type: boolean }
        scheduled_at: { type: string, format: date-time }
        published_at: { type: string, format: date-time }
        archived_at: { type: string, format: date-time }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
      required:
        [id, slug, title, excerpt, body_markdown, status, pinned, created_at, updated_at]
    Page:
      type: object
      properties:
        id: { type: string, format: uuid }
        slug: { type: string }
        title: { type: string }
        body_markdown: { type: string }
        rendered_html: { type: string }
        status: { $ref: '#/components/schemas/PageStatus' }
        scheduled_at: { type: string, format: date-time }
        published_at: { type: string, format: date-time }
        archived_at: { type: string, format: date-time }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
      required:
        [id, slug, title, body_markdown, rendered_html, status, created_at, updated_at]
    Tag:
      type: object
      properties:
        id: { type: string, format: uuid }
        slug: { type: string }
        name: { type: string }
        description: { type: string }
        pinned: { type: boolean }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
      required: [id, slug, name, pinned, created_at, updated_at]
    NavigationItem:
      type: object
      properties:
        id: { type: string, format: uuid }
        label: { type: string }
        destination_type: { $ref: '#/components/schemas/NavigationDestinationType' }
        destination_page_id: { type: string, format: uuid }
        destination_page_slug: { type: string }
        destination_url: { type: string }
        sort_order: { type: integer }
        visible: { type: boolean }
        open_in_new_tab: { type: boolean }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }
      required:
        [id, label, destination_type, sort_order, visible, open_in_new_tab, created_at, updated_at]
    Upload:
      type: object
      properties:
        id: { type: string, format: uuid }
        filename: { type: string }
        content_type: { type: string }
        size_bytes: { type: integer }
        checksum: { type: string }
        stored_path: { type: string }
        metadata: { type: object }
        created_at: { type: string, format: date-time }
      required: [id, filename, content_type, size_bytes, checksum, stored_path, created_at]
    Snapshot:
      type: object
      properties:
        id: { type: string, format: uuid }
        entity_type: { $ref: '#/components/schemas/SnapshotEntityType' }
        entity_id: { type: string, format: uuid }
        version: { type: integer }
        description: { type: string }
        schema_version: { type: integer }
        content:
          type: object
          additionalProperties: true
        created_at: { type: string, format: date-time }
      required:
        [id, entity_type, entity_id, version, schema_version, content, created_at]
    SnapshotCreateRequest:
      type: object
      required: [entity_type, entity_id]
      properties:
        entity_type: { $ref: '#/components/schemas/SnapshotEntityType' }
        entity_id: { type: string, format: uuid }
        description: { type: string }
    SiteSettings:
      type: object
      properties:
        homepage_size: { type: integer }
        admin_page_size: { type: integer }
        show_tag_aggregations: { type: boolean }
        show_month_aggregations: { type: boolean }
        tag_filter_limit: { type: integer }
        month_filter_limit: { type: integer }
        global_toc_enabled: { type: boolean }
        brand_title: { type: string }
        brand_href: { type: string }
        footer_copy: { type: string }
        public_site_url: { type: string }
        favicon_svg: { type: string }
        timezone: { type: string }
        meta_title: { type: string }
        meta_description: { type: string }
        og_title: { type: string }
        og_description: { type: string }
        updated_at: { type: string, format: date-time }
      required:
        [homepage_size, admin_page_size, show_tag_aggregations, show_month_aggregations,
         tag_filter_limit, month_filter_limit, global_toc_enabled, brand_title, brand_href,
         footer_copy, public_site_url, timezone, meta_title, meta_description, og_title,
         og_description, updated_at]
    Job:
      type: object
      properties:
        id: { type: string }
        job_type: { $ref: '#/components/schemas/JobType' }
        payload: { type: object }
        state: { $ref: '#/components/schemas/JobState' }
        attempts: { type: integer }
        max_attempts: { type: integer }
        run_at: { type: string, format: date-time }
        lock_at: { type: string, format: date-time }
        lock_by: { type: string }
        done_at: { type: string, format: date-time }
        last_error: { type: string }
        priority: { type: integer }
      required:
        [id, job_type, payload, state, attempts, max_attempts, run_at, priority]
    AuditEntry:
      type: object
      properties:
        id: { type: string, format: uuid }
        actor: { type: string }
        action: { type: string }
        entity_type: { type: string }
        entity_id: { type: string }
        payload_text: { type: string }
        created_at: { type: string, format: date-time }
      required: [id, actor, action, entity_type, created_at]
    PostStatus:
      type: string
      enum: [draft, published, archived, error]
    PageStatus:
      type: string
      enum: [draft, published, archived, error]
    SnapshotEntityType:
      type: string
      enum: [post, page]
    NavigationDestinationType:
      type: string
      enum: [internal, external]
    JobState:
      type: string
      enum: [pending, scheduled, running, done, failed, killed]
    JobType:
      type: string
      enum: [render_post, render_post_sections, render_post_section, render_page, render_summary,
             publish_post, publish_page]
    PostCreateRequest:
      type: object
      required: [title, excerpt, body_markdown]
      properties:
        title: { type: string }
        excerpt: { type: string }
        body_markdown: { type: string }
        summary_markdown: { type: string }
        status: { $ref: '#/components/schemas/PostStatus' }
        pinned: { type: boolean, default: false }
        scheduled_at: { type: string, format: date-time }
        published_at: { type: string, format: date-time }
        archived_at: { type: string, format: date-time }
    PostUpdateRequest:
      type: object
      required: [slug, title, excerpt, body_markdown]
      properties:
        slug: { type: string }
        title: { type: string }
        excerpt: { type: string }
        body_markdown: { type: string }
        summary_markdown: { type: string }
        pinned: { type: boolean, default: false }
    PostPinRequest:
      type: object
      required: [pinned]
      properties:
        pinned: { type: boolean }
    PostTitleRequest:
      type: object
      required: [title]
      properties:
        title: { type: string }
    PostExcerptRequest:
      type: object
      required: [excerpt]
      properties:
        excerpt: { type: string }
    PostBodyRequest:
      type: object
      required: [body_markdown]
      properties:
        body_markdown: { type: string }
    PostSummaryRequest:
      type: object
      properties:
        summary_markdown: { type: string }
    PostStatusRequest:
      type: object
      required: [status]
      properties:
        status: { $ref: '#/components/schemas/PostStatus' }
        scheduled_at: { type: string, format: date-time }
        published_at: { type: string, format: date-time }
        archived_at: { type: string, format: date-time }
    PostTagsRequest:
      type: object
      required: [tag_ids]
      properties:
        tag_ids:
          type: array
          items: { type: string, format: uuid }
    PageCreateRequest:
      type: object
      required: [title, body_markdown]
      properties:
        slug: { type: string }
        title: { type: string }
        body_markdown: { type: string }
        status: { $ref: '#/components/schemas/PageStatus' }
        scheduled_at: { type: string, format: date-time }
        published_at: { type: string, format: date-time }
        archived_at: { type: string, format: date-time }
    PageUpdateRequest:
      type: object
      required: [slug, title, body_markdown]
      properties:
        slug: { type: string }
        title: { type: string }
        body_markdown: { type: string }
    PageTitleRequest:
      type: object
      required: [title]
      properties:
        title: { type: string }
    PageBodyRequest:
      type: object
      required: [body_markdown]
      properties:
        body_markdown: { type: string }
    PageStatusRequest:
      type: object
      required: [status]
      properties:
        status: { $ref: '#/components/schemas/PageStatus' }
        scheduled_at: { type: string, format: date-time }
        published_at: { type: string, format: date-time }
        archived_at: { type: string, format: date-time }
    TagCreateRequest:
      type: object
      required: [name]
      properties:
        name: { type: string }
        description: { type: string }
        pinned: { type: boolean, default: false }
    TagUpdateRequest:
      type: object
      required: [name]
      properties:
        name: { type: string }
        description: { type: string }
        pinned: { type: boolean, default: false }
    TagPinRequest:
      type: object
      required: [pinned]
      properties:
        pinned: { type: boolean }
    TagNameRequest:
      type: object
      required: [name]
      properties:
        name: { type: string }
    TagDescriptionRequest:
      type: object
      properties:
        description: { type: string }
    NavigationCreateRequest:
      type: object
      required: [label, destination_type, sort_order]
      properties:
        label: { type: string }
        destination_type: { $ref: '#/components/schemas/NavigationDestinationType' }
        destination_page_id: { type: string, format: uuid }
        destination_url: { type: string }
        sort_order: { type: integer }
        visible: { type: boolean, default: false }
        open_in_new_tab: { type: boolean, default: false }
    NavigationUpdateRequest:
      type: object
      required: [label, destination_type, sort_order]
      properties:
        label: { type: string }
        destination_type: { $ref: '#/components/schemas/NavigationDestinationType' }
        destination_page_id: { type: string, format: uuid }
        destination_url: { type: string }
        sort_order: { type: integer }
        visible: { type: boolean, default: false }
        open_in_new_tab: { type: boolean, default: false }
    NavigationLabelRequest:
      type: object
      required: [label]
      properties:
        label: { type: string }
    NavigationDestinationRequest:
      type: object
      required: [destination_type]
      properties:
        destination_type: { $ref: '#/components/schemas/NavigationDestinationType' }
        destination_page_id: { type: string, format: uuid }
        destination_url: { type: string }
    NavigationSortOrderRequest:
      type: object
      required: [sort_order]
      properties:
        sort_order: { type: integer }
    NavigationVisibilityRequest:
      type: object
      required: [visible]
      properties:
        visible: { type: boolean }
    NavigationOpenInNewTabRequest:
      type: object
      required: [open_in_new_tab]
      properties:
        open_in_new_tab: { type: boolean }
    ApiKeyInfoResponse:
      type: object
      properties:
        name: { type: string }
        prefix: { type: string }
        scopes:
          type: array
          items: { $ref: '#/components/schemas/ApiScope' }
        status: { $ref: '#/components/schemas/ApiKeyStatus' }
        expires_at: { type: string, format: date-time }
        revoked_at: { type: string, format: date-time }
        last_used_at: { type: string, format: date-time }
    ApiKeyStatus:
      type: string
      description: Lifecycle status of an API key
      enum:
        - active
        - revoked
        - expired
        - disabled
        - pending
    ApiScope:
      type: string
      description: API scopes controlling headless access
      enum:
        - post_read
        - post_write
        - page_read
        - page_write
        - tag_read
        - tag_write
        - navigation_read
        - navigation_write
        - upload_read
        - upload_write
        - settings_read
        - settings_write
        - job_read
        - audit_read
        - snapshot_read
        - snapshot_write
    SettingsPatchRequest:
      type: object
      properties:
        brand_title: { type: string }
        brand_href: { type: string }
        footer_copy: { type: string }
        homepage_size: { type: integer }
        admin_page_size: { type: integer }
        show_tag_aggregations: { type: boolean }
        show_month_aggregations: { type: boolean }
        tag_filter_limit: { type: integer }
        month_filter_limit: { type: integer }
        timezone: { type: string }
        meta_title: { type: string }
        meta_description: { type: string }
        og_title: { type: string }
        og_description: { type: string }
        public_site_url: { type: string }
        global_toc_enabled: { type: boolean }
        favicon_svg: { type: string }
paths:
  /api/v1/api-keys/me:
    get:
      summary: Get current API key scopes
      description: Returns metadata and scopes for the authenticated API key. Requires any valid API key.
      responses:
        '200':
          description: API key info
          content:
            application/json:
              schema: { $ref: '#/components/schemas/ApiKeyInfoResponse' }
        '401': { description: Unauthorized }
        '403': { description: Forbidden }
  /api/v1/posts:
    get:
      summary: List posts
      description: Requires scope `post_read`.
      parameters:
        - in: query
          name: status
          schema: { $ref: '#/components/schemas/PostStatus' }
        - in: query
          name: search
          schema: { type: string }
        - in: query
          name: tag
          schema: { type: string }
        - in: query
          name: month
          schema: { type: string }
        - in: query
          name: cursor
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 100 }
      responses:
        '200':
          description: Paginated posts
          content:
            application/json:
              schema: { $ref: '#/components/schemas/CursorPagePost' }
        '401': { description: Unauthorized }
        '403': { description: Forbidden }
    post:
      summary: Create post
      description: Requires scope `post_write`.
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PostCreateRequest' }
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Post' }
        '400': { description: Bad request }
        '401': { description: Unauthorized }
        '403': { description: Forbidden }
  /api/v1/posts/{id}:
    get:
      summary: Get post by id
      description: Requires scope `post_read`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: Post
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Post' }
        '404': { description: Not found }
    patch:
      summary: Update post
      description: >
        Requires scope `post_write`. **Full replacement**: all fields must be sent (slug, title,
        excerpt, body_markdown, pinned, summary_markdown). Missing or placeholder values overwrite
        existing data. Use the dedicated subresource endpoints for partial updates.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PostUpdateRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Post' }
        '404': { description: Not found }
    delete:
      summary: Delete post
      description: Requires scope `post_write`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        '204': { description: Deleted }
        '404': { description: Not found }
  /api/v1/posts/{id}/status:
    post:
      summary: Update post status
      description: Requires scope `post_write`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PostStatusRequest' }
      responses:
        '200': { description: Status updated }
  /api/v1/posts/{id}/pin:
    post:
      summary: Update post pin state
      description: Requires scope `post_write`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PostPinRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Post' }
        '404': { description: Not found }
  /api/v1/posts/{id}/title:
    post:
      summary: Update post title
      description: Requires scope `post_write`. Slug is immutable and remains unchanged.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PostTitleRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Post' }
        '404': { description: Not found }
  /api/v1/posts/{id}/excerpt:
    post:
      summary: Update post excerpt
      description: Requires scope `post_write`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PostExcerptRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Post' }
        '404': { description: Not found }
  /api/v1/posts/{id}/body:
    post:
      summary: Update post body
      description: Requires scope `post_write`. Triggers re-render.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PostBodyRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Post' }
        '404': { description: Not found }
  /api/v1/posts/{id}/summary:
    post:
      summary: Update post summary
      description: Requires scope `post_write`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PostSummaryRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Post' }
        '404': { description: Not found }
  /api/v1/posts/{id}/tags:
    post:
      summary: Replace post tags
      description: Requires scope `post_write`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PostTagsRequest' }
      responses:
        '204': { description: Tags replaced }
  /api/v1/posts/slug/{slug}:
    get:
      summary: Get post by slug
      description: Requires scope `post_read`.
      parameters:
        - in: path
          name: slug
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Post
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Post' }
        '404': { description: Not found }
  /api/v1/pages:
    get:
      summary: List pages
      description: Requires scope `page_read`.
      parameters:
        - in: query
          name: status
          schema: { $ref: '#/components/schemas/PageStatus' }
        - in: query
          name: search
          schema: { type: string }
        - in: query
          name: month
          schema: { type: string }
        - in: query
          name: cursor
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 100 }
      responses:
        '200':
          description: Paginated pages
          content:
            application/json:
              schema: { $ref: '#/components/schemas/CursorPagePage' }
    post:
      summary: Create page
      description: Requires scope `page_write`.
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PageCreateRequest' }
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Page' }
  /api/v1/pages/{id}:
    get:
      summary: Get page by id
      description: Requires scope `page_read`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: Page
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Page' }
        '404': { description: Not found }
    patch:
      summary: Update page
      description: >
        Requires scope `page_write`. **Full replacement**: all fields must be sent (slug, title,
        body_markdown). Missing or placeholder values overwrite existing data. Use the subresource
        endpoints for partial updates.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PageUpdateRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Page' }
    delete:
      summary: Delete page
      description: Requires scope `page_write`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        '204': { description: Deleted }
  /api/v1/pages/{id}/status:
    post:
      summary: Update page status
      description: Requires scope `page_write`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PageStatusRequest' }
      responses:
        '200': { description: Status updated }
  /api/v1/pages/{id}/title:
    post:
      summary: Update page title
      description: Requires scope `page_write`. Slug is immutable and remains unchanged.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PageTitleRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Page' }
        '404': { description: Not found }
  /api/v1/pages/{id}/body:
    post:
      summary: Update page body
      description: Requires scope `page_write`. Triggers re-render.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/PageBodyRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Page' }
        '404': { description: Not found }
  /api/v1/pages/slug/{slug}:
    get:
      summary: Get page by slug
      description: Requires scope `page_read`.
      parameters:
        - in: path
          name: slug
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Page
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Page' }
        '404': { description: Not found }
  /api/v1/tags:
    get:
      summary: List tags
      description: Requires scope `tag_read`.
      parameters:
        - in: query
          name: search
          schema: { type: string }
        - in: query
          name: month
          schema: { type: string }
        - in: query
          name: cursor
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 100 }
        - in: query
          name: pinned
          schema: { type: boolean }
      responses:
        '200':
          description: Paginated tags
          content:
            application/json:
              schema: { $ref: '#/components/schemas/CursorPageTag' }
    post:
      summary: Create tag
      description: Requires scope `tag_write`.
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/TagCreateRequest' }
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Tag' }
  /api/v1/tags/{id}:
    get:
      summary: Get tag by id
      description: Requires scope `tag_read`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: Tag
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Tag' }
        '404': { description: Not found }
    patch:
      summary: Update tag
      description: >
        Requires scope `tag_write`. **Full replacement**: all fields must be sent (name, description,
        pinned). Missing or placeholder values overwrite existing data. Use subresource endpoints
        for partial updates.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/TagUpdateRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Tag' }
    delete:
      summary: Delete tag
      description: Requires scope `tag_write`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        '204': { description: Deleted }
  /api/v1/tags/slug/{slug}:
    get:
      summary: Get tag by slug
      description: Requires scope `tag_read`.
      parameters:
        - in: path
          name: slug
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Tag
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Tag' }
        '404': { description: Not found }
  /api/v1/tags/{id}/pin:
    post:
      summary: Update tag pin state
      description: Requires scope `tag_write`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/TagPinRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Tag' }
        '404': { description: Not found }
  /api/v1/tags/{id}/name:
    post:
      summary: Update tag name
      description: Requires scope `tag_write`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/TagNameRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Tag' }
        '404': { description: Not found }
  /api/v1/tags/{id}/description:
    post:
      summary: Update tag description
      description: Requires scope `tag_write`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/TagDescriptionRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Tag' }
        '404': { description: Not found }
  /api/v1/navigation:
    get:
      summary: List navigation items
      description: Requires scope `navigation_read`.
      parameters:
        - in: query
          name: search
          schema: { type: string }
        - in: query
          name: visible
          schema: { type: boolean }
        - in: query
          name: cursor
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 100 }
      responses:
        '200':
          description: Paginated navigation items
          content:
            application/json:
              schema: { $ref: '#/components/schemas/CursorPageNavigationItem' }
    post:
      summary: Create navigation item
      description: Requires scope `navigation_write`.
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/NavigationCreateRequest' }
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema: { $ref: '#/components/schemas/NavigationItem' }
  /api/v1/navigation/{id}:
    get:
      summary: Get navigation item by id
      description: Requires scope `navigation_read`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: Navigation item
          content:
            application/json:
              schema: { $ref: '#/components/schemas/NavigationItem' }
        '404': { description: Not found }
    patch:
      summary: Update navigation item
      description: >
        Requires scope `navigation_write`. **Full replacement**: all fields must be sent (label,
        destination, sort_order, visible, open_in_new_tab). Missing or placeholder values overwrite
        existing data. Use the subresource endpoints for partial updates.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/NavigationUpdateRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/NavigationItem' }
    delete:
      summary: Delete navigation item
      description: Requires scope `navigation_write`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        '204': { description: Deleted }
  /api/v1/navigation/{id}/label:
    post:
      summary: Update navigation label
      description: Requires scope `navigation_write`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/NavigationLabelRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/NavigationItem' }
        '404': { description: Not found }
  /api/v1/navigation/{id}/destination:
    post:
      summary: Update navigation destination
      description: Requires scope `navigation_write`. Validates page published when destination_type=internal.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/NavigationDestinationRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/NavigationItem' }
        '404': { description: Not found }
  /api/v1/navigation/{id}/sort-order:
    post:
      summary: Update navigation sort order
      description: Requires scope `navigation_write`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/NavigationSortOrderRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/NavigationItem' }
        '404': { description: Not found }
  /api/v1/navigation/{id}/visibility:
    post:
      summary: Update navigation visibility
      description: Requires scope `navigation_write`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/NavigationVisibilityRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/NavigationItem' }
        '404': { description: Not found }
  /api/v1/navigation/{id}/open-in-new-tab:
    post:
      summary: Update navigation open-in-new-tab flag
      description: Requires scope `navigation_write`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/NavigationOpenInNewTabRequest' }
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema: { $ref: '#/components/schemas/NavigationItem' }
        '404': { description: Not found }
  /api/v1/uploads:
    get:
      summary: List uploads
      description: Requires scope `upload_read`.
      parameters:
        - in: query
          name: search
          schema: { type: string }
        - in: query
          name: content_type
          schema: { type: string }
        - in: query
          name: month
          schema: { type: string }
        - in: query
          name: cursor
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 100 }
      responses:
        '200':
          description: Paginated uploads
          content:
            application/json:
              schema: { $ref: '#/components/schemas/CursorPageUpload' }
    post:
      summary: Upload file
      description: Requires scope `upload_write`. Multipart form with `file` field.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
      responses:
        '201':
          description: Uploaded
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Upload' }
  /api/v1/uploads/{id}:
    get:
      summary: Get upload by id
      description: Requires scope `upload_read`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: Upload
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Upload' }
        '404': { description: Not found }
    delete:
      summary: Delete upload
      description: Requires scope `upload_write`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        '204': { description: Deleted }
  /api/v1/site/settings:
    get:
      summary: Get site settings
      description: Requires scope `settings_read`.
      responses:
        '200':
          description: Settings
          content:
            application/json:
              schema: { $ref: '#/components/schemas/SiteSettings' }
    patch:
      summary: Patch site settings
      description: Requires scope `settings_write`.
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/SettingsPatchRequest' }
      responses:
        '200':
          description: Updated settings
          content:
            application/json:
              schema: { $ref: '#/components/schemas/SiteSettings' }
  /api/v1/jobs:
    get:
      summary: List jobs
      description: Requires scope `job_read`.
      parameters:
        - in: query
          name: state
          schema: { $ref: '#/components/schemas/JobState' }
        - in: query
          name: job_type
          schema: { $ref: '#/components/schemas/JobType' }
        - in: query
          name: search
          schema: { type: string }
        - in: query
          name: cursor
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 100 }
      responses:
        '200':
          description: Paginated jobs
          content:
            application/json:
              schema: { $ref: '#/components/schemas/CursorPageJob' }
  /api/v1/audit:
    get:
      summary: List audit entries
      description: Requires scope `audit_read`.
      parameters:
        - in: query
          name: actor
          schema: { type: string }
        - in: query
          name: action
          schema: { type: string }
        - in: query
          name: entity_type
          schema: { type: string }
        - in: query
          name: search
          schema: { type: string }
        - in: query
          name: cursor
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 100 }
      responses:
        '200':
          description: Paginated audit entries
          content:
            application/json:
              schema: { $ref: '#/components/schemas/CursorPageAudit' }
  /api/v1/snapshots:
    get:
      summary: List snapshots
      description: Requires scope `snapshot_read`.
      parameters:
        - in: query
          name: entity_type
          schema: { $ref: '#/components/schemas/SnapshotEntityType' }
        - in: query
          name: entity_id
          schema: { type: string, format: uuid }
        - in: query
          name: search
          schema: { type: string }
        - in: query
          name: cursor
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 100 }
      responses:
        '200':
          description: Paginated snapshots
          content:
            application/json:
              schema: { $ref: '#/components/schemas/CursorPageSnapshot' }
    post:
      summary: Create snapshot
      description: Requires scope `snapshot_write`.
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/SnapshotCreateRequest' }
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Snapshot' }
  /api/v1/snapshots/{id}:
    get:
      summary: Get snapshot by id
      description: Requires scope `snapshot_read`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: Snapshot
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Snapshot' }
        '404': { description: Not found }
  /api/v1/snapshots/{id}/rollback:
    post:
      summary: Rollback snapshot
      description: Requires scope `snapshot_write`.
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        '200':
          description: Snapshot after rollback
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Snapshot' }
        '404': { description: Not found }
